<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pagination with Search</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .item {
      padding: 15px;
      border-bottom: 1px solid #ddd;
      background-color: #f8f9fa;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    .pagination .page-item.active .page-link {
      background-color: #0d6efd;
      border-color: #0d6efd;
      color: #fff;
    }
    .item-field {
      margin-bottom: 5px;
    }
    .item-field strong {
      display: inline-block;
      width: 80px;
    }
    .highlight {
      background-color: yellow;
      font-weight: bold;
      padding: 2px 4px;
      border-radius: 3px;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
    <a class="navbar-brand" href="#">My Page</a>
    <div class="ms-auto d-flex align-items-center">
      <input class="form-control me-2" type="search" placeholder="Search..." id="searchInput">
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container my-4">
    <div id="itemContainer"></div>
    <nav>
      <div class="d-flex justify-content-center align-items-center">
        <ul class="pagination mb-0 me-3" id="pagination"></ul>
        <select class="form-select w-auto" id="itemsPerPage">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </div>
    </nav>
  </div>

  <script>
    // Simple dummy data
    const data = [
      { name: "John Smith", age: 25, gender: "Male" },
      { name: "Jane Doe", age: 30, gender: "Female" },
      { name: "Mike Johnson", age: 22, gender: "Male" },
      { name: "Sarah Wilson", age: 28, gender: "Female" },
      { name: "David Brown", age: 35, gender: "Male" },
      { name: "Emily Davis", age: 27, gender: "Female" },
      { name: "Tom Miller", age: 31, gender: "Male" },
      { name: "Lisa Garcia", age: 24, gender: "Female" },
      { name: "Mark Taylor", age: 29, gender: "Male" },
      { name: "Anna Lee", age: 26, gender: "Female" },
      { name: "Chris White", age: 33, gender: "Male" },
      { name: "Amy Clark", age: 23, gender: "Female" },
      { name: "Steve Hall", age: 32, gender: "Male" },
      { name: "Nina King", age: 21, gender: "Female" },
      { name: "Paul Scott", age: 34, gender: "Male" },
      { name: "Kate Adams", age: 25, gender: "Female" },
      { name: "Jim Green", age: 28, gender: "Male" },
      { name: "Rose Turner", age: 30, gender: "Female" },
      { name: "Dan Wright", age: 27, gender: "Male" },
      { name: "Eva Lopez", age: 29, gender: "Female" }
    ];

    let filteredData = [...data];
    let currentPage = 1;
    let itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);

    const itemContainer = document.getElementById('itemContainer');
    const pagination = document.getElementById('pagination');
    const searchInput = document.getElementById('searchInput');
    const itemsPerPageSelect = document.getElementById('itemsPerPage');

    // Function to highlight search terms in the item names.
    // text: the text to search in, searchTerm: the term to highlight
    function highlightText(text, searchTerm) {
      if (!searchTerm) return text;
      
      // RegExp() JS function to searchItem and check for global and case-insensitive matches
      const regex = new RegExp(searchTerm, 'gi');
      return text.replace(regex, `<span class="highlight">${searchTerm}</span>`);
    }

    // Function to render items based on current page and search term
    function renderItems() {
      itemContainer.innerHTML = '';
      // calculate starting and ending index for current page
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      // used slice on filteredData array to get the items for the current page.
      // eg: filteredData.slice(0,10) will return first 10 items
      const itemsToDisplay = filteredData.slice(start, end);

      if (itemsToDisplay.length === 0) {
        itemContainer.innerHTML = '<div class="alert alert-warning">No items found</div>';
        return;
      }

      // iterate through each items in itemsToDisplay and create a div for each item
      itemsToDisplay.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        
        const searchTerm = searchInput.value.trim(); 
        const highlightedName = highlightText(item.name, searchTerm);
        const highlightedAge = highlightText(item.age.toString(), searchTerm);
        const highlightedGender = highlightText(item.gender, searchTerm);
        
        div.innerHTML = `
          <div class="item-field"><strong>Name:</strong> ${highlightedName}</div>
          <div class="item-field"><strong>Age:</strong> ${highlightedAge}</div>
          <div class="item-field"><strong>Gender:</strong> ${highlightedGender}</div>
        `;
        itemContainer.appendChild(div);
      });
    }

    function renderPagination() {
      pagination.innerHTML = '';
      // filteredData = 20, itemsPerPage = 10, totalPages = 2. ceil() function rounds up, 21st item will go to page 3.
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);

      for (let i = 1; i <= Math.min(10, totalPages); i++) {
        const li = document.createElement('li');
        li.className = 'page-item' + (i === currentPage ? ' active' : '');
        const a = document.createElement('a');
        a.className = 'page-link';
        a.textContent = i;
        a.href = '#';
        a.addEventListener('click', (e) => {
          e.preventDefault();
          currentPage = i; //updating current page
          renderItems(); //show items for the selected page
          renderPagination(); // update pagination to reflect active page
        });
        li.appendChild(a); // <li class="page-item"><a class="page-link">1</a></li>
        pagination.appendChild(li);
      }
    }

    function update() {
      const searchTerm = searchInput.value.toLowerCase();
      filteredData = data.filter(item => 
        item.name.toLowerCase().includes(searchTerm) || 
        item.age.toString().includes(searchTerm) || 
        item.gender.toLowerCase().includes(searchTerm)
      );
      currentPage = 1; //resets to first page on new search
      renderItems();
      renderPagination();
    }

    searchInput.addEventListener('input', update);

    itemsPerPageSelect.addEventListener('change', () => {
      itemsPerPage = parseInt(itemsPerPageSelect.value);
      update(); // this will re-render with new itemsPerPage
    });

    // Initial render
    update();
  </script>

</body>
</html>
